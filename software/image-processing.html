<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Image processing - Ecam Eurobot</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <base href="../">

        <link rel="stylesheet" href="book.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <link rel="shortcut icon" href="favicon.png">

        <!-- Font Awesome -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">

        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        

    </head>
    <body class="light">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { } 
            if (theme === null || theme === undefined) { theme = 'light'; }
            document.body.className = theme;
            document.querySelector('html').className = theme + ' js';
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <ol class="chapter"><li class="affix"><a href="introduction.html">Introduction</a></li><li><a href="organization/organization.html"><strong aria-hidden="true">1.</strong> Organization</a></li><li><ol class="section"><li><a href="organization/github.html"><strong aria-hidden="true">1.1.</strong> GitHub</a></li><li><ol class="section"><li><a href="organization/gh-admin.html"><strong aria-hidden="true">1.1.1.</strong> Administration</a></li></ol></li><li><a href="organization/mdbook.html"><strong aria-hidden="true">1.2.</strong> mdBook</a></li></ol></li><li><a href="mechanical/mechanical.html"><strong aria-hidden="true">2.</strong> Mechanical</a></li><li><ol class="section"><li><a href="mechanical/fusion.html"><strong aria-hidden="true">2.1.</strong> 3D modeling with Fusion360</a></li><li><a href="mechanical/3d-print.html"><strong aria-hidden="true">2.2.</strong> 3D printing</a></li><li><a href="mechanical/practices.html"><strong aria-hidden="true">2.3.</strong> Fusion360 Good practices</a></li><li><a href="mechanical/mecanum.html"><strong aria-hidden="true">2.4.</strong> Mecanum wheels</a></li><li><a href="mechanical/vacuum.html"><strong aria-hidden="true">2.5.</strong> Vacuum prehention</a></li><li><a href="mechanical/2018/2018.html"><strong aria-hidden="true">2.6.</strong> 2018 specifics</a></li><li><ol class="section"><li><a href="mechanical/2018/bigRobot.html"><strong aria-hidden="true">2.6.1.</strong> Block mechanism</a></li><li><a href="mechanical/2018/balls.html"><strong aria-hidden="true">2.6.2.</strong> Ball mechanism</a></li></ol></li></ol></li><li><a href="electronics/electronics.html"><strong aria-hidden="true">3.</strong> Electronics</a></li><li><ol class="section"><li><a href="electronics/actuators/actuators.html"><strong aria-hidden="true">3.1.</strong> Actuators</a></li><li><ol class="section"><li><a href="electronics/actuators/dynamixels.html"><strong aria-hidden="true">3.1.1.</strong> Dynamixels</a></li></ol></li><li><a href="electronics/sensors/sensors.html"><strong aria-hidden="true">3.2.</strong> Sensors</a></li><li><ol class="section"><li><a href="electronics/sensors/sonar.html"><strong aria-hidden="true">3.2.1.</strong> Sonar</a></li><li><a href="electronics/sensors/coloursensor.html"><strong aria-hidden="true">3.2.2.</strong> Color Sensor</a></li><li><a href="electronics/sensors/mouse.html"><strong aria-hidden="true">3.2.3.</strong> Mouse</a></li></ol></li><li><a href="electronics/pcb/1_PCB_Design.html"><strong aria-hidden="true">3.3.</strong> PCB Design</a></li><li><ol class="section"><li><a href="electronics/pcb/2_Starting_Board.html"><strong aria-hidden="true">3.3.1.</strong> Start board</a></li><li><a href="electronics/pcb/3_Motor_Board.html"><strong aria-hidden="true">3.3.2.</strong> Motor board</a></li><li><a href="electronics/pcb/4_Com_Shield.html"><strong aria-hidden="true">3.3.3.</strong> Communication shield</a></li><li><a href="electronics/pcb/PowerSpply.html"><strong aria-hidden="true">3.3.4.</strong> Power supply board</a></li><li><a href="electronics/pcb/5_Appendix.html"><strong aria-hidden="true">3.3.5.</strong> Appendix</a></li></ol></li><li><a href="electronics/fpga.html"><strong aria-hidden="true">3.4.</strong> FPGA</a></li><li><a href="electronics/communication/communication.html"><strong aria-hidden="true">3.5.</strong> Communication</a></li><li><ol class="section"><li><a href="electronics/communication/i2c.html"><strong aria-hidden="true">3.5.1.</strong> I2C</a></li><li><a href="electronics/communication/spi.html"><strong aria-hidden="true">3.5.2.</strong> SPI</a></li><li><a href="electronics/communication/can.html"><strong aria-hidden="true">3.5.3.</strong> CAN</a></li></ol></li></ol></li><li><a href="software/software.html"><strong aria-hidden="true">4.</strong> Software</a></li><li><ol class="section"><li><a href="software/docker.html"><strong aria-hidden="true">4.1.</strong> Docker</a></li><li><a href="software/ros/ros.html"><strong aria-hidden="true">4.2.</strong> ROS</a></li><li><ol class="section"><li><a href="software/ros/install.html"><strong aria-hidden="true">4.2.1.</strong> Install</a></li><li><a href="software/ros/basics/basics.html"><strong aria-hidden="true">4.2.2.</strong> Basic concepts</a></li><li><ol class="section"><li><a href="software/ros/basics/workspace.html"><strong aria-hidden="true">4.2.2.1.</strong> Workspace setup</a></li><li><a href="software/ros/basics/packages.html"><strong aria-hidden="true">4.2.2.2.</strong> Packages</a></li><li><a href="software/ros/basics/pub.html"><strong aria-hidden="true">4.2.2.3.</strong> Publisher</a></li><li><a href="software/ros/basics/sub.html"><strong aria-hidden="true">4.2.2.4.</strong> Subscriber</a></li><li><a href="software/ros/basics/example.html"><strong aria-hidden="true">4.2.2.5.</strong> Example</a></li><li><a href="software/ros/basics/launch.html"><strong aria-hidden="true">4.2.2.6.</strong> Launchfiles</a></li><li><a href="software/ros/basics/params.html"><strong aria-hidden="true">4.2.2.7.</strong> ROS parameters</a></li><li><a href="software/ros/basics/practices.html"><strong aria-hidden="true">4.2.2.8.</strong> Good Practices</a></li></ol></li><li><a href="software/ros/rosserial.html"><strong aria-hidden="true">4.2.3.</strong> ROS and Arduino</a></li><li><ol class="section"><li><a href="software/ros/arduino/publisher.html"><strong aria-hidden="true">4.2.3.1.</strong> Publisher</a></li><li><a href="software/ros/arduino/subscriber.html"><strong aria-hidden="true">4.2.3.2.</strong> Subscriber</a></li></ol></li><li><a href="software/ros/advanced/advanced.html"><strong aria-hidden="true">4.2.4.</strong> Advanced concepts</a></li><li><ol class="section"><li><a href="software/ros/advanced/custom-msgs.html"><strong aria-hidden="true">4.2.4.1.</strong> Custom messages</a></li><li><a href="software/ros/advanced/model.html"><strong aria-hidden="true">4.2.4.2.</strong> Robot model</a></li><li><a href="software/ros/advanced/rviz.html"><strong aria-hidden="true">4.2.4.3.</strong> Rviz</a></li></ol></li><li><a href="software/ros/packages/packages.html"><strong aria-hidden="true">4.2.5.</strong> Useful packages</a></li><li><ol class="section"><li><a href="software/ros/packages/map.html"><strong aria-hidden="true">4.2.5.1.</strong> Map Server</a></li><li><a href="software/ros/packages/nav.html"><strong aria-hidden="true">4.2.5.2.</strong> Navigation stack</a></li></ol></li></ol></li><li><a href="software/mecanum/mecanum.html"><strong aria-hidden="true">4.3.</strong> Mecanum wheels</a></li><li><a href="software/image-processing.html" class="active"><strong aria-hidden="true">4.4.</strong> Image processing</a></li></ol></li><li><a href="robots/robots.html"><strong aria-hidden="true">5.</strong> Robots</a></li><li><ol class="section"><li><a href="robots/2018.html"><strong aria-hidden="true">5.1.</strong> 2018</a></li><li><ol class="section"><li><a href="robots/structure.html"><strong aria-hidden="true">5.1.1.</strong> Structure of folder</a></li><li><a href="robots/2018/minus/minus.html"><strong aria-hidden="true">5.1.2.</strong> Minus (big robot)</a></li><li><ol class="section"><li><a href="robots/2018/minus/architecture.html"><strong aria-hidden="true">5.1.2.1.</strong> Architecture</a></li><li><a href="robots/2018/minus/packages.html"><strong aria-hidden="true">5.1.2.2.</strong> Packages</a></li><li><a href="robots/2018/minus/howto.html"><strong aria-hidden="true">5.1.2.3.</strong> How to run the robot</a></li></ol></li></ol></li><li><a href="robots/2019.html"><strong aria-hidden="true">5.2.</strong> 2019</a></li><li><ol class="section"><li><a href="robots/2019/soja.html"><strong aria-hidden="true">5.2.1.</strong> Soja</a></li><li><ol class="section"><li><a href="robots/2019/soja/code.html"><strong aria-hidden="true">5.2.1.1.</strong> Code</a></li><li><ol class="section"><li><a href="robots/2019/soja/code/motors.html"><strong aria-hidden="true">5.2.1.1.1.</strong> Arduino/motors.ino</a></li><li><a href="robots/2019/soja/code/odom.html"><strong aria-hidden="true">5.2.1.1.2.</strong> rpi/odom.cpp</a></li><li><a href="robots/2019/soja/code/move.html"><strong aria-hidden="true">5.2.1.1.3.</strong> rpi/move.py</a></li><li><a href="robots/2019/soja/code/ultrasound_rpi.html"><strong aria-hidden="true">5.2.1.1.4.</strong> rpi/ultrasound.py</a></li></ol></li><li><a href="robots/2019/soja/Encoders.html"><strong aria-hidden="true">5.2.1.2.</strong> Encoders</a></li><li><a href="robots/2019/soja/improvements.html"><strong aria-hidden="true">5.2.1.3.</strong> Improvements</a></li></ol></li></ol></li></ol></li><li><a href="graphic/graphic_chart.html">Appendix A: Graphic chart</a></li></ol>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem" class="theme" id="light">Light <span class="default">(default)</span></button></li>
                                <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            </ul>
                            
                            <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                            
                        </div>

                        <h1 class="menu-title">Ecam Eurobot</h1> 

                        <div class="right-buttons">
                            <a href="print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                        </div>
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <a class="header" href="software/image-processing.html#color-detection" id="color-detection"><h1>Color detection</h1></a>
<blockquote>
<p>The objective of this module is to detect a color combination and send it to the “Minus” robot module whose function is to build a tower made of cubes.</p>
</blockquote>
<a class="header" href="software/image-processing.html#getting-started" id="getting-started"><h2>Getting started</h2></a>
<a class="header" href="software/image-processing.html#image-treatment-module" id="image-treatment-module"><h3>Image treatment module</h3></a>
<a class="header" href="software/image-processing.html#summary" id="summary"><h4>Summary</h4></a>
<p>First and foremost, we must connect to GoPro wifi to take a picture of the color combination. Here, we have chosen a GoPro as a camera because it has an acceptable quality (780 pixel-HD) and it has also a Wi-Fi module for the remote control.</p>
<p>Once the photo has been taken, the camera automatically switches off and we connect to the robot by wifi (a Raspberry connected with the same Wi-Fi for future image treatment).</p>
<p>During this treatment, we use the OpenCV free graphics library.</p>
<p>We have drawn three frames on the picture (one for each cube to detect) to delimit the test portion. The board analyzes all pixels within each frame to obtain the color.</p>
<p>However, we have implemented in our program the different possible combinations to save time. Indeed, we only required two colors to deduce the final combination.</p>
<p>As a matter of conclusion, we send combination to the robot by ROS.</p>
<p><img src="img/software/image-processing/image1.png" alt="z" /></p>
<a class="header" href="software/image-processing.html#bill-of-materials" id="bill-of-materials"><h4>Bill of materials:</h4></a>
<ul>
<li>One Raspberry Pi zero W</li>
<li>One Wi-Fi GoPro (Hero+)</li>
<li>One 5V battery</li>
<li>Etcher (https://etcher.io/) to install an OS on the Raspberry</li>
</ul>
<a class="header" href="software/image-processing.html#connections" id="connections"><h4>Connections</h4></a>
<ul>
<li>No pins required</li>
</ul>
<a class="header" href="software/image-processing.html#setup" id="setup"><h4>Setup</h4></a>
<ul>
<li>Download last version Ubuntu mate (16.04) or an another distribution for the raspberry (see <a href="ros/install.md">install</a>)</li>
<li>Active WiFi and open terminal (<strong><em>alt+ctrl+t</em></strong>):
<ol>
<li>
<p>Install ROS (see <a href="ros/install.md">install</a>)</p>
</li>
<li>
<p>Download this repo from <a href="https://github.com/Ecam-Eurobot/Tutorials/archive/master.zip">github</a>, unzip Tutorials-master.zip to open the main folder.</p>
</li>
<li>
<p>Drag the folder in the terminal, you'll see a url. Then run this command :</p>
<pre><code>cd &quot;url&quot;
</code></pre>
</li>
<li>
<p>Run this code above to go to &quot;codes&quot; folder:</p>
<pre><code>cd src/codes/software/image-processing/tests
</code></pre>
</li>
<li>
<p>Connect the GoPro (WiFi) or your webcam (USB port) to the Raspberry</p>
</li>
</ol>
</li>
</ul>
<a class="header" href="software/image-processing.html#checking-camera" id="checking-camera"><h3>Checking camera</h3></a>
<p>Check your camera is working. Type the following command line into your prompt and press enter :</p>
<ol>
<li>Go to &quot;test camera&quot; folder :</li>
</ol>
<pre><code>cd src/codes/software/image-processing/tests/test_camera
</code></pre>
<p><strong>Checking GoPro</strong></p>
<p>We use a library called &quot;goprocam&quot; that contains all functions to control GoPro</p>
<ul>
<li>
<p>Run this command to test GoPro in your terminal</p>
<pre><code>python3 go_pro_test.py
</code></pre>
<p><strong><em>Make sure your Raspberry is on the same WiFi network as GoPro !</em></strong></p>
</li>
</ul>
<p>The code :</p>
<pre><code>#go_pro_test.py

from goprocam import GoProCamera
from goprocam import constants

# Connect to GoPro
gpCam = GoProCamera.GoPro()

# Take a photo and save it in the current folder 
gpCam.downloadLastMedia(gpCam.take_photo(0))
</code></pre>
<p><strong>Checking webcam</strong></p>
<p>If you don't have a GoPro, you can also use a webcam. Type the following command line into your prompt and press enter :</p>
<p>We use here &quot;OpenCV&quot; library to display and save images from the webcam</p>
<ul>
<li>
<p>Run this command to check the webcam</p>
<pre><code>python webcam_test.py
</code></pre>
</li>
</ul>
<p>The code :</p>
<pre><code># webcam_test.py

import cv2 

# Create an object called camera and connect the first camera to the computer
camera = cv2.VideoCapture(0)

# Take a photo and save it in the current folder 
return_value, image = camera.read()
cv2.imwrite('opencv'+'.png', image)
</code></pre>
<p><strong>Result</strong> :
<img src="img/software/image-processing/image5.png" alt="z" /></p>
<a class="header" href="software/image-processing.html#scripts" id="scripts"><h2>Scripts</h2></a>
<p>After checking the camera, we must run a script to automate the color detection and the WiFi switching (if you use a GoPro).<br />
This script makes three actions :</p>
<ol>
<li>To switch WiFi to connect to GoPro to obtain a picture</li>
<li>To send the picture to the Raspberry to start the image processing</li>
<li>To give a color combination</li>
</ol>
<p>Type the following command line into your prompt and press enter to check the settings and run the script</p>
<ul>
<li>Go to color_detection folder :</li>
</ul>
<pre><code>cd ../test_color_detection
</code></pre>
<ul>
<li>Open GP_combination.sh :</li>
</ul>
<pre><code>nano GP_combination.sh 
</code></pre>
<ul>
<li>Change the name with your GoPro WiFi :</li>
</ul>
<pre><code>nmcli c up &quot;your GoPro wifi&quot;
</code></pre>
<ul>
<li>Change the name with your robot WiFi</li>
</ul>
<pre><code>nmcli c up &quot;your wifi robot&quot;  
</code></pre>
<p>save it (<strong><em>ctrl+x</em></strong>)</p>
<ul>
<li>Run this script on the terminal :</li>
</ul>
<pre><code>bash GP_combination.sh 
</code></pre>
<p>You'll see 3 colors frames on the picture and the final combination color on the terminal)
<img src="img/software/image-processing/image6.png" alt="z" /></p>
<p>The code :</p>
<pre><code>#GP_Combination.sh

#!/usr/bin/expect

#switch to &quot;GoPro wifi and connect to the GoPro&quot; 

nmcli c up &quot;armen&quot; 
sleep 10

#Take photo with GoPro
python3 GP_takePhoto.py

#Switch to &quot;robot wifi to connect to minus(robots)

nmcli c up &quot;Airport Express Lenaerts&quot; 

#To obtain the color combination 
python2 color_detection.py
</code></pre>
<p>If you prefer using the webcam instead of GoPro</p>
<pre><code>bash WB_combination.sh 
</code></pre>
<p>The code :</p>
<pre><code>#WB_combination.sh 

#!/usr/bin/expect

python2 WB_takePhoto.py

python2 color_detection.py
</code></pre>
<p><strong>Result</strong> :
The result is the same for GoPro and webcam.</p>
<p>You'll see 3 colors frames on the picture and the final combination color on the terminal as shown in the image below</p>
<p><img src="img/software/image-processing/image6.png" alt="z" /></p>
<a class="header" href="software/image-processing.html#image-processing---color_detectionpy" id="image-processing---color_detectionpy"><h2>Image processing - color_detection.py</h2></a>
<p>After taking a picture with the camera or the GoPro, we must process it to generate the color combination :
The program creates three frames, one for each cube and analyzes all pixels within each frame:</p>
<ol>
<li>It looks whether the color detected is in the range color defined for every color (each color range is defined with one high and one low BGR value)</li>
<li>After that, it returns a value: more the value is great, more the color lies within the range. The program adds up the values and the final value thus obtained determines the color within the range of colors determined initially.</li>
</ol>
<p><strong>Adjusting the position of a frame</strong></p>
<p>We must adjust the position of frames to target the part of the image we want to process :<br />
Each position is represented by a matrice. The first value (pixel) is linked with red frame, the second value (pixel) with yellow frame and the last value (pixel) with white frame.</p>
<p><img src="img/software/image-processing/image2.png" alt="before" /></p>
<p><em>positionName = [red frame value, yellow frame value, white frame value]</em></p>
<p>Here is the different positions for each frame:</p>
<ul>
<li><strong>xmin</strong> is the left side of the frame</li>
<li><strong>xmax</strong> is the right side par of the frame</li>
<li><strong>ymin</strong> is the top side of the frame</li>
<li><strong>ymax</strong> is the bottom side of the frame</li>
</ul>
<p><strong>Procedure</strong> :</p>
<ol>
<li>Maintain your cursor where you want to place a side of the frame</li>
<li>Take note of the position (pixel)</li>
<li>Open a new tab (<strong><em>ctrl+shift+t</em></strong>) and run this command to change a side of a frame in the following code(color_detection.py) :</li>
</ol>
<pre><code>nano color_detection.py 
</code></pre>
<ol start="4">
<li>Restart for another side of the frame then save the file (<strong><em>ctrl+x</em></strong>)</li>
</ol>
<p><strong><em>Result</em></strong> :</p>
<p><img src="img/software/image-processing/image3.png" alt="after" /></p>
<p><strong>Adjusting the range color</strong></p>
<p>We must adjust the color range (RBG) to define each color. Therefore, the programme will be able to identify differents colors in each frame in function of these RGB values. We represente  each color range by a matrix :</p>
<p><em>color_range = [blue value, green value, red value]</em></p>
<p>As a reminder, an RGB color value is specified with RGB (red, green, blue).
Each parameter (red, green, and blue) defines the intensity of the color as an integer between 0 and 255.
For example, rgb(0, 0, 255) is rendered as blue, because the blue parameter is set to its highest value (255) and the others are set to 0.</p>
<p><strong>Procedure</strong> :</p>
<ol>
<li>Maintain your cursor in the center of the cube</li>
<li>Take note of the RGB color</li>
<li>Open a new tab (<strong><em>ctrl+shift+t</em></strong>) and change the color range in the code (color_detection.py)</li>
</ol>
<pre><code>nano color_detection.py 
</code></pre>
<ol start="4">
<li>Restart for another cube then save the file (<strong><em>ctrl+x</em></strong>)</li>
</ol>
<p><strong><em>Result</em></strong> :</p>
<p><img src="img/software/image-processing/image4.png" alt="z" /></p>
<p><strong>Automation</strong></p>
<p>We have also implemented in our program the different possible combinations to save time. Indeed, we only required two colors to deduce the final combination.</p>
<a class="header" href="software/image-processing.html#application-with-ros" id="application-with-ros"><h2>Application with ROS</h2></a>
<p>You use <strong><em>ROS</em></strong> to send the color combination to another robot module :</p>
<ol>
<li>Create a package &quot;image-processing&quot; and create a launch files&quot; test.launch&quot; (more details <a href="ros/install.md">here</a>)</li>
<li>Drag the code &quot;image-analyze.py&quot;(codes/software/image-processing) to catkin_ws/src/&quot;image-processing&quot;</li>
<li>Open terminal and launch ROS :</li>
</ol>
<pre><code>. ~/eurobot_ws/devel/setup.bash
roslaunch image-processing test.launch 
</code></pre>
<ul>
<li>Open a new tab (<strong><em>ctrl+shift+t</em></strong>) to display messages published to a topic :</li>
</ul>
<pre><code>rostopic echo /color_seq 
</code></pre>
<p><img src="img/software/image-processing/image7.png" alt="z" /></p>
<p><strong><em>Don't forget to change frames positions and color ranges ! (see section below)</em></strong></p>
<a class="header" href="software/image-processing.html#flashlight-module" id="flashlight-module"><h3>Flashlight module</h3></a>
<a class="header" href="software/image-processing.html#aim" id="aim"><h4>Aim</h4></a>
<p>We added a LED flashlight above the camera because light is an important factor and can bias our previous calculations. Therefore, the constant level of light thus created enables us to maintain our settings. This flashlight is turned off immediately after the camera has taken the photo, so as not to disrupt other teams or distract the audience.</p>
<a class="header" href="software/image-processing.html#bill-of-materials-1" id="bill-of-materials-1"><h4>Bill of materials:</h4></a>
<ul>
<li>One Raspberry Pi zero W</li>
<li>One LED flashlight</li>
<li>One 5V battery</li>
</ul>
<a class="header" href="software/image-processing.html#connections-1" id="connections-1"><h4>Connections</h4></a>
<p>We use pin 4 of the raspberry Pi zero to power the gate pin of IRF520 mosfet in order to control the light. The board is powered with a 5V power supply from the battery (pin 2 = 5V and pin 6= GND).</p>
<a class="header" href="software/image-processing.html#setup-1" id="setup-1"><h4>Setup</h4></a>
<ul>
<li>for testing the flashlight, run :</li>
</ul>
<pre><code>python flashlight.py
</code></pre>
<p>You'll blink the flashlight</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="software/mecanum/mecanum.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="robots/robots.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a href="software/mecanum/mecanum.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a href="robots/robots.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script src="searchindex.js" type="text/javascript" charset="utf-8"></script>
        
        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
